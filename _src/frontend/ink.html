<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Editor - Wissen-Wasser</title>
    <select id="theme-selector" onchange="setTheme(this.value)" class="desktop-only">
</head>
<body>
    <div id="toolbar">
        <button id="save-btn" onclick="manualSave()">Salvar (Ctrl+S)</button>
        
        <select id="theme-selector" onchange="setTheme(this.value)" class="desktop-only">
            <option value="desktop">Estilo JSONBin</option>
            <option value="beautifulink">BeautifulInk</option>
        </select>

        <select id="font-selector" class="desktop-only">
            <option value="inherit">Fonte Padrão</option>
        </select>

        <label class="file-label desktop-only">
            + Fonte .ttf
            <input type="file" id="font-upload" accept=".ttf" onchange="handleFontImport(event)" style="display:none">
        </label>

        <div style="margin-left: auto; display: flex; align-items: center; gap: 15px;">
            <span id="ink-id-display" style="font-family: monospace; font-size: 12px; opacity: 0.6;">ID: temp-ink</span>
            <span id="status">Pronto</span>
        </div>
    </div>

    <div id="editor-container">
        </div>
    
    <script src="js/core.js"></script>
    <script src="js/editor.js"></script>
    <script>
        async function manualSave() {
            const status = document.getElementById('status');
            status.innerText = "Sincronizando...";
            
            const urlParams = new URLSearchParams(window.location.search);
            const inkId = urlParams.get('id') || 'temp-ink';
            
            // Coleta texto de TODAS as páginas (A4) ou do editor único (Kindle)
            const pages = document.querySelectorAll('.page');
            let content = "";
            
            if (pages.length > 0) {
                content = Array.from(pages).map(p => p.innerText).join('\n');
            } else {
                const singleEditor = document.getElementById('editor');
                content = singleEditor ? singleEditor.innerText : "";
            }
            
            try {
                const result = await apiSaveInk(inkId, content);
                if (result) {
                    status.innerText = "Salvo na nuvem!";
                    // Se o ID mudou (era temp-ink), atualiza o display
                    document.getElementById('ink-id-display').innerText = `ID: ${result}`;
                } else {
                    status.innerText = "Erro (salvo local)";
                }
            } catch (e) {
                status.innerText = "Offline (cache)";
            }
        }
    </script>
</body>
</html>