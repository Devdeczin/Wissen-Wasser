<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Editor - Wissen-Wasser</title>
    <link id="theme-style" rel="stylesheet" href="css/inkindle.css">
</head>
<body>
    <div id="toolbar">
        <button id="save-btn" onclick="manualSave()">Salvar (Ctrl+S)</button>
        
        <select id="theme-selector" onchange="setTheme(this.value)" class="desktop-only">
            <option value="desktop">Estilo JSONBin</option>
            <option value="beautifulink">BeautifulInk</option>
        </select>

        <select id="font-selector" class="desktop-only">
            <option value="inherit">Fonte Padrão</option>
        </select>

        <label class="file-label desktop-only">
            + Fonte .ttf
            <input type="file" id="font-upload" accept=".ttf" onchange="handleFontImport(event)" style="display:none">
        </label>

        <span id="status">Pronto</span>
    </div>

    <div id="editor-container"></div>
    
    <script src="js/core.js"></script>
    <script src="js/editor.js"></script>
    <script>
        // Função global de salvamento ajustada para a lógica de páginas
        async function manualSave() {
            const status = document.getElementById('status');
            status.innerText = "enviando...";
            
            // Pega o ID da URL
            const inkId = new URLSearchParams(window.location.search).get('id') || 'temp-ink';
            
            // Pega o texto de dentro da página atual (seja Kindle ou Desktop)
            const editorElem = document.querySelector('.page') || document.getElementById('editor');
            const content = editorElem ? editorElem.innerText : "";
            
            try {
                const success = await apiSaveInk(inkId, content);
                if (success) {
                    status.innerText = "salvo na nuvem!";
                } else {
                    status.innerText = "erro rede (em cache)";
                }
            } catch (e) {
                status.innerText = "offline (em cache)";
            }
        }
    </script>
</body>
</html>